


<!DOCTYPE html>

<html>
<head>
    <meta charset="utf-8">
    <title></title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <link href="/Scripts/Layui/css/layui.css" rel="stylesheet"/>
<link href="/Content/css/main.css" rel="stylesheet"/>
<link href="/Scripts/Layui/icon/icon.css" rel="stylesheet"/>

    <script src="/Scripts/jquery-3.5.1.min.js"></script>
<script src="/Scripts/Layui/layui.all.js"></script>
<script src="/Scripts/js/datetime.js"></script>

    <script src="/hyrcjs/windowsutils.js"></script>
    <script src="https://res.wx.qq.com/connect/zh_CN/htmledition/js/wxLogin.js"></script>
    <style>
        .element::-webkit-scrollbar {
            width: 0 !important
        }
        .element {
            -ms-overflow-style: none;
            overflow: -moz-scrollbars-none;
        } 
        iframe {
            overflow: hidden;
            height: 300px !important;
        } 
        .status {
            display: none;
        } 
        .impowerBox .status p {
            display: none;
        }

        .layui-layer-load {
            background: #eee !important;
        }
    </style>
</head>
<body>
    <div style="margin:0px auto;width:99%;padding:10px;box-sizing:border-box">
        <div style="text-align: center; color: #194b70;font-size:13pt">请使用微信验证</div>
        <div id="qrcode" style="height:200px;margin-top:10px"></div>
        <div id="timeer" style="width:308px;text-align:center;color:#194b70"></div>
    </div>
    <script>
        var t = 60;
        var count = 60;
        var byz = 0;
        var obj = new WxLogin({
            self_redirect: true,
            id: "qrcode",
            appid: "wxe037d48f13e59e2f",
            scope: "snsapi_login",
            redirect_uri: "https%3a%2f%2fcms.slyb.top%2fWeChat%2fCallbackStudy",
            state: "C4149F666C0AB963CF256474A5E63003BD33C49D54A2C6ED00FB0434DBBB45644CEC0FE8D39020E13A247932612B3DF926C3F044D7E34C9AB48ACF19A6E52EB8093B23330D2F5813FEACD1E7F312776C5FF94E469C1951E93011D71691506DBCC6C9AD399C49966EC65A168986104A64C40768307CB53528E2B14C8BF830AF3F15EFB80E67B90864",
            style: "black",
            fast_login: 0,
            href: "https%3a%2f%2fcms.slyb.top%2fplugins%2fweixin%2fweixin.css",
            onReady: function (isReady) {
                console.log(isReady);
            }
        });

         //计时器：防止超时不扫码或者不同意/一旦扫码就会跳转到ReturnStudy
        var checkInterval = setInterval(function () {
            count--;
            if (byz == 0) {
                $('#timeer').html("验证倒计时" + count + "秒");
                if (count == 0) {
                    clearInterval(checkInterval);
                    $.ajax({
                        url: "/WeChat/TimeOut",
                        data: { imgid:40543122},
                        type: "POST",
                        async: false,
                        success: function (data) {
                            if (data.code == 0) {
                                layer.alert("此次微信验证超时，请点击继续学习", { icon: 5, closeBtn: 0}, function (index) {
                                    parent.layer.closeAll();
                                    var curindex = getparentWindows(parent.parent, "ZXXX/IndexCLASSTest");
                                    parent.parent[curindex].player.seek(376)
                                    parent.parent[curindex].player.play();
                                });
                            }
                            else if (data.code == -1) {
                                layer.alert("第1次微信验证未通过，请注意第2次微信扫码验证，若2次验证均未通过（如验证超时、使用其他非绑定微信扫码等），需重新学习当节课程", { icon: 5, closeBtn: 0 }, function (index) {
                                    parent.layer.closeAll();
                                    var curindex = getparentWindows(parent.parent, "ZXXX/IndexCLASSTest");
                                    parent.parent[curindex].player.seek(376)
                                    parent.parent[curindex].player.play();
                                });
                            }
                            else {
                                layer.alert(data.msg, { icon: 5, closeBtn: 0 }, function (index) {
                                    parent.layer.closeAll();
                                    var curindex = getparentWindows(parent.parent, "ZXXX/IndexCLASSTest");
                                    parent.parent[curindex].location.href = "/ZXXX/Index?token=CB33334C58EC0DC37DC12C7BFC9581C9B26877F3C2963CD7FCB41962FBD172483B48341AC58A584F6DAC7D7CCCC98DA3D9E78F8E7DD2B7D5";
                                });
                            }
                        }
                    })
                }
                else if (count < 55 && count % 2 == 0) {
                    $.get("/WeChat/CheckVerfystudy?imgid=40543122", function (res) {
                        if (res.code == 1) {
                            byz = 1;
                            clearInterval(checkInterval);
                            layer.alert("微信验证通过,请点击继续学习", { icon: 6, closeBtn: 0 }, function (index) {
                                parent.layer.closeAll();
                                var curindex = getparentWindows(parent.parent, "ZXXX/IndexCLASSTest");
								parent.parent[curindex].zp1 = 0;
                                parent.parent[curindex].zp2 = 0;
                                parent.parent[curindex].player.seek(376)
                                parent.parent[curindex].player.play();
                            })
                        }
                        else if (res.code == -1) {
                            byz = 1;
                            clearInterval(checkInterval);
                            layer.alert("第1次微信验证未通过，请注意第2次微信扫码验证，若2次验证均未通过（如验证超时、使用其他非绑定微信扫码等），需重新学习当节课程", { icon: 5, closeBtn: 0 }, function (index) {
                                parent.layer.closeAll();
                                var curindex = getparentWindows(parent.parent, "ZXXX/IndexCLASSTest");
                                    parent.parent[curindex].player.seek(376)
                                    parent.parent[curindex].player.play();
                            })
                        }
                        else if (res.code==-2)  {
                            byz = 1;
                            clearInterval(checkInterval);
                            layer.alert(res.msg, { icon: 5, closeBtn: 0 }, function (index) {
                                parent.layer.closeAll();
                                var curindex = getparentWindows(parent.parent, "ZXXX/IndexCLASSTest");
                                parent.parent[curindex].location.href = "/ZXXX/Index?token=CB33334C58EC0DC37DC12C7BFC9581C9B26877F3C2963CD7FCB41962FBD172483B48341AC58A584F6DAC7D7CCCC98DA3D9E78F8E7DD2B7D5";
                            })
                        }
                    });
                }
            }
        }, 1000);

        $(document).ready(function () {
            var subIframe = parent.$("iframe")[parent.$("iframe").length - 1];
            if (subIframe != "undefined") {
                subIframe.onload = function () {
                    subIframe.scrolling = "no";
                };
            }
        });
    </script>
</body>
</html>
